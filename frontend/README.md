# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 
–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Flask —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –¥–≤—É—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ [OGC SensorThings API](https://www.ogc.org/standards/sensorthings) –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–µ —Å –¥–∞—à–±–æ—Ä–¥–æ–º. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
- –ë–î PostgreSQL —Å –¥–∞–Ω–Ω–Ω—ã–º–∏ —Å FrostServers (docker image: `uroplatus666/frosts-db:latest`)
- –ë–î PostgreSQL —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –∏ —Ä–∞—Å—Ç—Ä–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (docker image: `uroplatus666/gis-db:latest`)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ –±–∞–∑–µ Folium —Å–æ —Å–ª–æ—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–Ω—Å–æ—Ä–∞ SensorThings;
- –ø–æ–ø–∞–ø—ã —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º MultiDatastreams / Datastreams –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–∞—à–±–æ—Ä–¥;
- –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –ø–æ –≤—Å–µ–º –∏–∑–º–µ—Ä–µ–Ω–∏—è–º –∏ —Ä–∞—Å—á—ë—Ç —Ä–æ–∑—ã –≤–µ—Ç—Ä–æ–≤ –ø–æ –¥–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞ –†–£–î–ù;
- API `/api/data/<sensor_key>` –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–∞—à–±–æ—Ä–¥–∞ –∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤;
- –≥–æ—Ç–æ–≤—ã–µ HTML-–¥–∞—à–±–æ—Ä–¥—ã —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ Plotly –∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π;
- —Ä–∞—Å—Ç—Ä–æ–≤—ã–µ –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Å–ª–æ–∏
- —Ö–æ—Ä–æ—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

## üß©–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
.
‚îú‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .dockerignore         # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
‚îú‚îÄ‚îÄ .gitignore            # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose —Å–æ —Å–±–æ—Ä–∫–æ–π –∏ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ pyproject.toml        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ uv.lock               # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ Dockerfile            # Docker-–æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ README.md             # –í—ã —á–∏—Ç–∞–µ—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ app.py                # –ö–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ services/             # –õ–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ gis.py            # –†–∞–±–æ—Ç–∞ —Å –ë–î –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ sensors.py        # –†–∞–±–æ—Ç–∞ —Å –ë–î —Å–µ–Ω—Å–æ—Ä–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ static/               # –°—Ç–∞—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.css # –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ map.css       # –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ dashboard.js  # –°–∫—Ä–∏–ø—Ç—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤
‚îî‚îÄ‚îÄ templates/            # HTML-—à–∞–±–ª–æ–Ω—ã
    ‚îú‚îÄ‚îÄ dashboard.html    # –®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞—à–±–æ—Ä–¥–∞
    ‚îî‚îÄ‚îÄ map_partials/     # –ö—É—Å–∫–∏ HTML/JS –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ Folium
        ‚îú‚îÄ‚îÄ css_inject.html
        ‚îî‚îÄ‚îÄ js_inject.html
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ë–î –ø–æ–¥–Ω—è—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python ‚â• 3.10 –∏ [uv](https://github.com/astral-sh/uv) (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   uv sync
   source .venv/bin/activate
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

   ```bash
   python app.py
   ```

   –°–µ—Ä–≤–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –Ω–∞ `http://127.0.0.1:9090/`.


## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í —Ñ–∞–π–ª–µ `.env.docker.example` –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ .env, –∫—É–¥–∞ –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç—ã

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                  | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é             |
|-------------------------|---------------------------------------------|-----------------------------------|
| `DB_HOST`               | —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Å–µ—Ä–≤–∏—Å–∞ –≤ docker-compose |db-frost                           |
| `DB_PORT`               | –ü–æ—Ä—Ç –¥–ª—è –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏ —Å FrostServers        |5432                               |
| `DB_EXTERNAL_PORT`      | –ü–æ—Ä—Ç –¥–ª—è –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏ —Å FrostServers        |5434                               |
| `DB_NAME`               | –ò–º—è –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏ —Å FrostServers             |<DB_NAME>                          |
| `DB_USER`               | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î —Å FrostServers              |<DB_USER>                          |
| `DB_PASS`               | –ü–∞—Ä–æ–ª—å –æ—Ç –ë–î —Å FrostServers                 |<DB_PASS>                          |
| `PGHOST`                | —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Å–µ—Ä–≤–∏—Å–∞ –≤ docker-compose |db-spatial                         |
| `PGPORT`                | –ü–æ—Ä—Ç –¥–ª—è –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏ —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏          |5432                               |
| `PG_EXTERNAL_PORT`      | –ü–æ—Ä—Ç –¥–ª—è –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏ —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏          |5433                               |
| `PGDATABASE`            | –ò–º—è –ë–î —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏                         |<PGDATABASE>                       |
| `PGUSER`                | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏                |<PGUSER>                           |
| `PGPASS`                | –ü–∞—Ä–æ–ª—å –æ—Ç –ë–î —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏                   |<PGPASS>                           |
| `PORT`                  | –ü–æ—Ä—Ç –Ω–∞ —Ö–æ—Å—Ç–µ –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ Docker           |9090                               |

## –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker compose up -d
```
–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–∞–º–∞—è —Ç—è–∂–µ–ª–∞—è –ë–î –¥–æ–≥—Ä—É–∑–∏–ª–∞—Å—å (–∂–¥–µ–º `database system is ready to accept connections`)

```bash
docker logs -f db-spatial
```

–°–µ—Ä–≤–µ—Ä –∑–¥–µ—Å—å: `http://127.0.0.1:<port>/`.

–û—Å—Ç–∞–Ω–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ volumes

```bash
docker compose down -v
```
